on:
  workflow_dispatch:
  # triggered when a new montly build create a tag
  push: 
    tags:
      - v*
    
name: Build Choco package

jobs:
  build-windows:
    runs-on: windows-latest
    name: Build chocolatey package

    steps:
    - name: Clone repo
      uses: actions/checkout@v3

    - name: Build Choco package
      working-directory: choco
      run: |
        choco pack
        choco install --no-progress tinytex -source "'.;https://chocolatey.org/api/v2/'"
        choco uninstall -y tinytex

    - name: Publish Choco Package
      if: ${{ false }} # ${{ github.event_name == 'push' && contains(github.event.ref, "tags/v") }}
      run: |
        if ( ($Env:APPVEYOR_REPO_TAG -eq "true") -and ($Env:APPVEYOR_REPO_TAG_NAME -ne "daily") ) {
          choco apikey --key $Env:CHOCO_KEY --source https://push.chocolatey.org/
          choco push --source https://push.chocolatey.org/
        }